@using pz_server_administrator.Services
@inject ILocalizationService LocService
@inject NavigationManager NavigationManager

<FluentSelect TOption="KeyValuePair<string, string>"
    Label="Language"
    Items="@languageNames"
    OptionText="(item) => item.Value"
    OptionValue="(item) => item.Key"
    @bind-Value="selectedLanguage"
    @bind-Value:after="OnLanguageChangedAsync" />

@code {
    private string selectedLanguage = string.Empty;
    private Dictionary<string, string> languageNames = new Dictionary<string, string>();

    protected override async Task OnInitializedAsync()
    {
        selectedLanguage = LocService.CurrentLanguage;
        foreach (var lang in LocService.AvailableLanguages)
        {
            var langName = await LocService.GetLanguageNameAsync(lang);
            languageNames.Add(lang, langName);
        }
    }

    private async Task OnLanguageChangedAsync()
    {
        await LocService.SetLanguage(selectedLanguage);
        NavigationManager.NavigateTo(NavigationManager.Uri, forceLoad: true);
    }
}